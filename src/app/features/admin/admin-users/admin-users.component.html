<div class="admin-container">
  <h1>ğŸ‘¥ Gestion des Utilisateurs</h1>

  <!-- Statistiques -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-content">
        <h3>{{ users().length }}</h3>
        <p>Total Utilisateurs</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘‘</div>
      <div class="stat-content">
        <h3>{{ countByRole("admin") }}</h3>
        <p>Admins</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ‘¤</div>
      <div class="stat-content">
        <h3>{{ countByRole("user") }}</h3>
        <p>Users</p>
      </div>
    </div>
  </div>

  <!-- Formulaire de crÃ©ation -->
  <div class="form-card">
    <h2>{{ editMode ? "Modifier" : "CrÃ©er" }} un utilisateur</h2>
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label>Nom d'utilisateur *</label>
          <input type="text" formControlName="username" placeholder="JohnDoe" />
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input
            type="email"
            formControlName="email"
            placeholder="john@example.com"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Mot de passe *</label>
          <input
            type="password"
            formControlName="password"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢"
          />
        </div>
        <div class="form-group">
          <label>RÃ´le *</label>
          <select formControlName="role">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Solde initial</label>
        <input
          type="number"
          formControlName="balance"
          placeholder="0"
          min="0"
          step="0.01"
        />
      </div>

      <div class="form-actions">
        <button
          type="submit"
          class="btn-primary"
          [disabled]="userForm.invalid || loading"
        >
          {{ loading ? "Chargement..." : editMode ? "Modifier" : "CrÃ©er" }}
        </button>
        @if (editMode) {
        <button type="button" class="btn-secondary" (click)="cancelEdit()">
          Annuler
        </button>
        }
      </div>
    </form>
  </div>

  <!-- Table des utilisateurs -->
  <div class="table-card">
    <h2>Liste des utilisateurs ({{ users().length }})</h2>
    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>RÃ´le</th>
            <th>Solde</th>
            <th>Inscription</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (user of users(); track user.id) {
          <tr>
            <td>{{ user.id }}</td>
            <td>
              <strong>{{ user.username }}</strong>
            </td>
            <td>{{ user.email }}</td>
            <td>
              <span [class]="'role-badge ' + user.role">{{ user.role }}</span>
            </td>
            <td class="balance">{{ user.balance }}â‚¬</td>
            <td>{{ user.created_at | date : "short" }}</td>
            <td>
              <button class="btn-icon" (click)="viewStats(user)" title="Stats">
                ğŸ“Š
              </button>
              <button
                class="btn-icon"
                (click)="editUser(user)"
                title="Modifier"
              >
                âœï¸
              </button>
              <button
                class="btn-icon"
                (click)="creditBalance(user)"
                title="CrÃ©diter"
              >
                ğŸ’°
              </button>
              <button
                class="btn-icon danger"
                (click)="deleteUser(user)"
                title="Supprimer"
              >
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
